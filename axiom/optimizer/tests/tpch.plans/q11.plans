numWorkers: 1
numDrivers: 1

Query Graph:

dt5: ps_partkey, value
  output:
    ps_partkey := dt1.ps_partkey
    value := dt1.value
  tables: dt1, dt6
  filter: gt(dt1.value, dt6.expr)
  orderBy: dt1.value DESC NULLS LAST

dt1: ps_partkey, value
  output:
    ps_partkey := t2.ps_partkey
    value := dt1.value
  tables: t2, t3, t4
  joins:
    t2 INNER t3 ON t2.ps_suppkey = t3.s_suppkey
    t3 INNER t4 ON t3.s_nationkey = t4.n_nationkey
  syntactic join order: 8, 22, 31
  aggregates: sum(multiply(t2.ps_supplycost, __cast(t2.ps_availqty AS DOUBLE))) AS value
  grouping keys: t2.ps_partkey

t2: ps_partkey, ps_suppkey, ps_availqty, ps_supplycost
  table: partsupp

t3: s_suppkey, s_nationkey
  table: supplier

t4: n_nationkey, n_name
  table: nation
  single-column filters: eq(t4.n_name, "GERMANY")

dt6: expr
  output:
    expr := multiply(dt6.sum, 0.0001)
  tables: t7, t8, t9
  joins:
    t7 INNER t8 ON t7.ps_suppkey = t8.s_suppkey
    t8 INNER t9 ON t8.s_nationkey = t9.n_nationkey
  syntactic join order: 47, 51, 54
  aggregates: sum(multiply(t7.ps_supplycost, __cast(t7.ps_availqty AS DOUBLE))) AS sum

t7: ps_suppkey, ps_availqty, ps_supplycost
  table: partsupp

t8: s_suppkey, s_nationkey
  table: supplier

t9: n_nationkey, n_name
  table: nation
  single-column filters: eq(t9.n_name, "GERMANY")


Optimized plan (oneline):

(agg((partsupp INNER (supplier INNER nation))) INNER agg((partsupp INNER (supplier INNER nation))))

Optimized plan:

Project -> dt5.ps_partkey, dt5.value
    dt5.ps_partkey := dt1.ps_partkey
    dt5.value := dt1.value
  OrderBy -> dt1.ps_partkey, dt1.value, dt6.expr
    Filter -> dt1.ps_partkey, dt1.value, dt6.expr
        gt(dt1.value, dt6.expr)
      Join INNER Cross -> dt1.ps_partkey, dt1.value, dt6.expr
        Project (redundant) -> dt1.ps_partkey, dt1.value
            dt1.ps_partkey := t2.ps_partkey
            dt1.value := dt1.value
          Aggregation (t2.ps_partkey) -> t2.ps_partkey, dt1.value
              dt1.value := sum(dt1.__p39)
            Project -> t2.ps_partkey, dt1.__p39
                t2.ps_partkey := t2.ps_partkey
                dt1.__p39 := multiply(t2.ps_supplycost, __cast(t2.ps_availqty AS DOUBLE))
              Join INNER Hash -> t2.ps_partkey, t2.ps_availqty, t2.ps_supplycost
                  t2.ps_suppkey = t3.s_suppkey
                TableScan -> t2.ps_partkey, t2.ps_suppkey, t2.ps_availqty, t2.ps_supplycost
                  table: partsupp
                Join INNER Hash -> t3.s_suppkey
                    t3.s_nationkey = t4.n_nationkey
                  TableScan -> t3.s_suppkey, t3.s_nationkey
                    table: supplier
                  TableScan -> t4.n_nationkey
                    table: nation
                    single-column filters: eq(t4.n_name, "GERMANY")
        Project -> dt6.expr
            dt6.expr := multiply(dt6.sum, 0.0001)
          Aggregation -> dt6.sum
              dt6.sum := sum(dt6.__p61)
            Project -> dt6.__p61
                dt6.__p61 := multiply(t7.ps_supplycost, __cast(t7.ps_availqty AS DOUBLE))
              Join INNER Hash -> t7.ps_availqty, t7.ps_supplycost
                  t7.ps_suppkey = t8.s_suppkey
                TableScan -> t7.ps_suppkey, t7.ps_availqty, t7.ps_supplycost
                  table: partsupp
                Join INNER Hash -> t8.s_suppkey
                    t8.s_nationkey = t9.n_nationkey
                  TableScan -> t8.s_suppkey, t8.s_nationkey
                    table: supplier
                  TableScan -> t9.n_nationkey
                    table: nation
                    single-column filters: eq(t9.n_name, "GERMANY")


Executable Velox plan:

Fragment 0:  numWorkers=0:
-- Project[18][expressions: (ps_partkey:BIGINT, "ps_partkey"), (value:DOUBLE, "value")] -> ps_partkey:BIGINT, value:DOUBLE
  -- OrderBy[17][value DESC NULLS LAST] -> ps_partkey:BIGINT, value:DOUBLE, expr:DOUBLE
    -- Filter[0][expression: gt("value","expr")] -> ps_partkey:BIGINT, value:DOUBLE, expr:DOUBLE
      -- NestedLoopJoin[16][INNER] -> ps_partkey:BIGINT, value:DOUBLE, expr:DOUBLE
        -- Aggregation[7][SINGLE [ps_partkey] value := sum("dt1.__p39")] -> ps_partkey:BIGINT, value:DOUBLE
          -- Project[6][expressions: (ps_partkey:BIGINT, "ps_partkey"), (dt1.__p39:DOUBLE, multiply("ps_supplycost",cast("ps_availqty" as DOUBLE)))] -> ps_partkey:BIGINT, "dt1.__p39":DOUBLE
            -- HashJoin[5][INNER ps_suppkey=s_suppkey] -> ps_partkey:BIGINT, ps_availqty:INTEGER, ps_supplycost:DOUBLE
              -- TableScan[1][table: partsupp, data columns: ROW<ps_partkey:BIGINT,ps_suppkey:BIGINT,ps_availqty:INTEGER,ps_supplycost:DOUBLE,ps_comment:VARCHAR>] -> ps_partkey:BIGINT, ps_suppkey:BIGINT, ps_availqty:INTEGER, ps_supplycost:DOUBLE
              -- HashJoin[4][INNER s_nationkey=n_nationkey] -> s_suppkey:BIGINT
                -- TableScan[2][table: supplier, data columns: ROW<s_suppkey:BIGINT,s_name:VARCHAR,s_address:VARCHAR,s_nationkey:BIGINT,s_phone:VARCHAR,s_acctbal:DOUBLE,s_comment:VARCHAR>] -> s_suppkey:BIGINT, s_nationkey:BIGINT
                -- TableScan[3][table: nation, range filters: [(n_name, Filter(BytesValues, deterministic, no nulls))], data columns: ROW<n_nationkey:BIGINT,n_name:VARCHAR,n_regionkey:BIGINT,n_comment:VARCHAR>, filter column handles: [HiveColumnHandle [name: n_name, columnType: Regular, dataType: VARCHAR, requiredSubfields: [ ]]]] -> n_nationkey:BIGINT
        -- Project[15][expressions: (expr:DOUBLE, multiply("sum",0.0001))] -> expr:DOUBLE
          -- Aggregation[14][SINGLE sum := sum("dt6.__p61")] -> sum:DOUBLE
            -- Project[13][expressions: (dt6.__p61:DOUBLE, multiply("ps_supplycost_7",cast("ps_availqty_6" as DOUBLE)))] -> "dt6.__p61":DOUBLE
              -- HashJoin[12][INNER ps_suppkey_5=s_suppkey_11] -> ps_availqty_6:INTEGER, ps_supplycost_7:DOUBLE
                -- TableScan[8][table: partsupp, data columns: ROW<ps_partkey:BIGINT,ps_suppkey:BIGINT,ps_availqty:INTEGER,ps_supplycost:DOUBLE,ps_comment:VARCHAR>] -> ps_suppkey_5:BIGINT, ps_availqty_6:INTEGER, ps_supplycost_7:DOUBLE
                -- HashJoin[11][INNER s_nationkey_14=n_nationkey_20] -> s_suppkey_11:BIGINT
                  -- TableScan[9][table: supplier, data columns: ROW<s_suppkey:BIGINT,s_name:VARCHAR,s_address:VARCHAR,s_nationkey:BIGINT,s_phone:VARCHAR,s_acctbal:DOUBLE,s_comment:VARCHAR>] -> s_suppkey_11:BIGINT, s_nationkey_14:BIGINT
                  -- TableScan[10][table: nation, range filters: [(n_name, Filter(BytesValues, deterministic, no nulls))], data columns: ROW<n_nationkey:BIGINT,n_name:VARCHAR,n_regionkey:BIGINT,n_comment:VARCHAR>, filter column handles: [HiveColumnHandle [name: n_name, columnType: Regular, dataType: VARCHAR, requiredSubfields: [ ]]]] -> n_nationkey_20:BIGINT

___END___
