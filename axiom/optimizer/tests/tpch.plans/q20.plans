numWorkers: 1
numDrivers: 1

Query Graph:

dt1: s_name, s_address
  output:
    s_name := t2.s_name
    s_address := t2.s_address
  tables: t2, t3, dt4
  joins:
    t2 SEMI dt4 ON t2.s_suppkey = dt4.ps_suppkey
    t2 INNER t3 ON t2.s_nationkey = t3.n_nationkey
  syntactic join order: 10, 21, 24
  filter: dt1.__mark1
  orderBy: t2.s_name ASC NULLS LAST

t2: s_suppkey, s_name, s_address, s_nationkey
  table: supplier

t3: n_nationkey, n_name
  table: nation
  single-column filters: eq(t3.n_name, "CANADA")

dt4: ps_suppkey
  output:
    ps_suppkey := t5.ps_suppkey
  tables: t5, dt6, dt8
  joins:
    t5 LEFT dt6 ON t5.ps_partkey = dt6.l_partkey AND t5.ps_suppkey = dt6.l_suppkey
    t5 SEMI dt8 ON t5.ps_partkey = dt8.p_partkey
  syntactic join order: 32, 36, 84
  filter: dt4.__mark0 and lt(dt6.expr, __cast(t5.ps_availqty AS DOUBLE))

t5: ps_partkey, ps_suppkey, ps_availqty
  table: partsupp

dt6: l_partkey, l_suppkey, expr
  output:
    l_partkey := t7.l_partkey
    l_suppkey := t7.l_suppkey
    expr := multiply(dt6.sum, 0.5)
  tables: t7
  aggregates: sum(t7.l_quantity) AS sum
  grouping keys: t7.l_partkey, t7.l_suppkey

t7: l_partkey, l_suppkey, l_quantity, l_shipdate
  table: lineitem
  single-column filters: gte(t7.l_shipdate, "1994-01-01") and lt(t7.l_shipdate, "1995-01-01")

dt8: p_partkey
  output:
    p_partkey := t9.p_partkey
  tables: t9

t9: p_partkey, p_name
  table: part
  single-column filters: like(t9.p_name, "forest%")


Optimized plan (oneline):

((agg(lineitem) RIGHT (partsupp LEFT SEMI (FILTER) part)) RIGHT SEMI (FILTER) (supplier INNER nation))

Optimized plan:

Project (redundant) -> dt1.s_name, dt1.s_address
    dt1.s_name := t2.s_name
    dt1.s_address := t2.s_address
  OrderBy -> t2.s_name, t2.s_address
    Join RIGHT SEMI (FILTER) Hash -> t2.s_name, t2.s_address
        dt4.ps_suppkey = t2.s_suppkey
      Project -> dt4.ps_suppkey
          dt4.ps_suppkey := t5.ps_suppkey
        Filter -> t5.ps_suppkey, t5.ps_availqty, dt6.expr
            lt(dt6.expr, __cast(t5.ps_availqty AS DOUBLE))
          Join RIGHT Hash -> t5.ps_suppkey, t5.ps_availqty, dt6.expr
              dt6.l_partkey = t5.ps_partkey
              dt6.l_suppkey = t5.ps_suppkey
            Project -> dt6.l_partkey, dt6.l_suppkey, dt6.expr
                dt6.l_partkey := t7.l_partkey
                dt6.l_suppkey := t7.l_suppkey
                dt6.expr := multiply(dt6.sum, 0.5)
              Aggregation (t7.l_partkey, t7.l_suppkey) -> t7.l_partkey, t7.l_suppkey, dt6.sum
                  dt6.sum := sum(t7.l_quantity)
                TableScan -> t7.l_partkey, t7.l_suppkey, t7.l_quantity
                  table: lineitem
                  single-column filters: gte(t7.l_shipdate, "1994-01-01") and lt(t7.l_shipdate, "1995-01-01")
            Join LEFT SEMI (FILTER) Hash -> t5.ps_partkey, t5.ps_suppkey, t5.ps_availqty
                t5.ps_partkey = dt8.p_partkey
              TableScan -> t5.ps_partkey, t5.ps_suppkey, t5.ps_availqty
                table: partsupp
              Project (redundant) -> dt8.p_partkey
                  dt8.p_partkey := t9.p_partkey
                TableScan -> t9.p_partkey
                  table: part
                  single-column filters: like(t9.p_name, "forest%")
      Join INNER Hash -> t2.s_suppkey, t2.s_name, t2.s_address
          t2.s_nationkey = t3.n_nationkey
        TableScan -> t2.s_suppkey, t2.s_name, t2.s_address, t2.s_nationkey
          table: supplier
        TableScan -> t3.n_nationkey
          table: nation
          single-column filters: eq(t3.n_name, "CANADA")


Executable Velox plan:

Fragment 0:  numWorkers=0:
-- OrderBy[13][s_name ASC NULLS LAST] -> s_name:VARCHAR, s_address:VARCHAR
  -- HashJoin[12][RIGHT SEMI (FILTER) ps_suppkey=s_suppkey] -> s_name:VARCHAR, s_address:VARCHAR
    -- Project[8][expressions: (ps_suppkey:BIGINT, "ps_suppkey")] -> ps_suppkey:BIGINT
      -- Filter[0][expression: lt("expr",cast("ps_availqty" as DOUBLE))] -> ps_suppkey:BIGINT, ps_availqty:INTEGER, expr:DOUBLE
        -- HashJoin[7][RIGHT l_partkey=ps_partkey AND l_suppkey=ps_suppkey] -> ps_suppkey:BIGINT, ps_availqty:INTEGER, expr:DOUBLE
          -- Project[3][expressions: (l_partkey:BIGINT, "l_partkey"), (l_suppkey:BIGINT, "l_suppkey"), (expr:DOUBLE, multiply("sum",0.5))] -> l_partkey:BIGINT, l_suppkey:BIGINT, expr:DOUBLE
            -- Aggregation[2][SINGLE [l_partkey, l_suppkey] sum := sum("l_quantity")] -> l_partkey:BIGINT, l_suppkey:BIGINT, sum:DOUBLE
              -- TableScan[1][table: lineitem, range filters: [(l_shipdate, BigintRange: [8766, 9130] no nulls)], data columns: ROW<l_orderkey:BIGINT,l_partkey:BIGINT,l_suppkey:BIGINT,l_linenumber:INTEGER,l_quantity:DOUBLE,l_extendedprice:DOUBLE,l_discount:DOUBLE,l_tax:DOUBLE,l_returnflag:VARCHAR,l_linestatus:VARCHAR,l_shipdate:DATE,l_commitdate:DATE,l_receiptdate:DATE,l_shipinstruct:VARCHAR,l_shipmode:VARCHAR,l_comment:VARCHAR>, filter column handles: [HiveColumnHandle [name: l_shipdate, columnType: Regular, dataType: DATE, requiredSubfields: [ ]]]] -> l_partkey:BIGINT, l_suppkey:BIGINT, l_quantity:DOUBLE
          -- HashJoin[6][LEFT SEMI (FILTER) ps_partkey=p_partkey] -> ps_partkey:BIGINT, ps_suppkey:BIGINT, ps_availqty:INTEGER
            -- TableScan[4][table: partsupp, data columns: ROW<ps_partkey:BIGINT,ps_suppkey:BIGINT,ps_availqty:INTEGER,ps_supplycost:DOUBLE,ps_comment:VARCHAR>] -> ps_partkey:BIGINT, ps_suppkey:BIGINT, ps_availqty:INTEGER
            -- TableScan[5][table: part, remaining filter: (like("p_name",forest%)), data columns: ROW<p_partkey:BIGINT,p_name:VARCHAR,p_mfgr:VARCHAR,p_brand:VARCHAR,p_type:VARCHAR,p_size:INTEGER,p_container:VARCHAR,p_retailprice:DOUBLE,p_comment:VARCHAR>, filter column handles: [HiveColumnHandle [name: p_name, columnType: Regular, dataType: VARCHAR, requiredSubfields: [ ]]]] -> p_partkey:BIGINT
    -- HashJoin[11][INNER s_nationkey=n_nationkey] -> s_suppkey:BIGINT, s_name:VARCHAR, s_address:VARCHAR
      -- TableScan[9][table: supplier, data columns: ROW<s_suppkey:BIGINT,s_name:VARCHAR,s_address:VARCHAR,s_nationkey:BIGINT,s_phone:VARCHAR,s_acctbal:DOUBLE,s_comment:VARCHAR>] -> s_suppkey:BIGINT, s_name:VARCHAR, s_address:VARCHAR, s_nationkey:BIGINT
      -- TableScan[10][table: nation, range filters: [(n_name, Filter(BytesValues, deterministic, no nulls))], data columns: ROW<n_nationkey:BIGINT,n_name:VARCHAR,n_regionkey:BIGINT,n_comment:VARCHAR>, filter column handles: [HiveColumnHandle [name: n_name, columnType: Regular, dataType: VARCHAR, requiredSubfields: [ ]]]] -> n_nationkey:BIGINT

___END___
